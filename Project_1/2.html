<!DOCTYPE html>
<html lang="zh-cn">
<head>
<meta charset="gb2312" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="Cache-Control" content="no-store, must-revalidate">
<meta http-equiv="expires" content="Wed, 26 Feb 1997 08:21:57 GMT">
<meta http-equiv="expires" content="0">
<link rel="shortcut icon" href="/cpp/favicon.ico?v=3.97" />
<link href="/cpp/templets/new/style/common.css?v=3.97" rel="stylesheet" type="text/css" />
<title>C语言perror()函数：打印最近一次系统错误信息_C语言中文网</title>
<meta name="keywords" content="语言,错误,处理,函数,perror,印出,原因,信息,字符" />
<meta name="description" content="相关函数 strerror 头文件 #include stdio.h 定义函数 void perror(const char *s); 函数说明 perror()用来将上一个函数发生错误的原因输出到标准错误(stderr). 参数s 所指的字符串会先打印 出, 后面再加上错误原因字符串. 此错误原因依照全局变量errno 的值" />
</head>
<body>
<div id="topbar-wrap">
<div id="topbar" class="clearfix">
<ul id="nav-top" class="left clearfix hover-none">
<li><a href="/cpp/compiler/">编程软件下载/编译器下载</a></li>
</ul>
<ul id="ad-link-top" class="left hover-none">
<li class="sub-menu" style="color: #D33428;">&nbsp;&nbsp;C语言辅导班<span class="icon">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<ul>
<li><a href="http://fudao.biancheng.net/c/" target="_blank">普通班(600元)</a></li>
<li><a href="http://fudao.biancheng.net/c_abroad/" target="_blank">留学生班(2000元)</a></li>
</ul>
</li>
<li class="sub-menu" style="color: #009300;">&nbsp;&nbsp;C++辅导班<span class="icon">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<ul>
<li><a href="http://fudao.biancheng.net/cpp/" target="_blank">普通班(1000元)</a></li>
<li><a href="http://fudao.biancheng.net/cpp_abroad/" target="_blank">留学生班(3000元)</a></li>
</ul>
</li>
<li class="sub-menu" style="color: #AD9700;">&nbsp;&nbsp;算法/数据结构辅导班<span class="icon">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<ul>
<li><a href="http://fudao.biancheng.net/data/" target="_blank">普通班(600元)</a></li>
<li><a href="http://fudao.biancheng.net/data_abroad/" target="_blank">留学生班(2000元)</a></li>
</ul>
</li>
<li style="color: #D33428;">QQ交流群：<span class="qq-qun-number">loading...</span></li>
</ul>
<div class="right clearfix" id="user-info"></div>
</div>
</div>
<div id="header_wrap" class="clearfix">
<div id="header" class="hover-none">
<a id="logo" class="left" href="/cpp/"><img src="/cpp/templets/new/images/logo.jpg?v=3.97" alt="C语言中文网"></a>
<ul id="nav-main" class="left clearfix">
<li><a href="/cpp/">首页</a></li>
<li><a href="/cpp/u/jiaocheng/">C语言教程</a></li>
<li><a href="/cpp/u/c20/">C语言和内存</a></li>
<li><a href="/cpp/biancheng/cpp/rumen/">C++教程</a></li>
<li><a href="/cpp/u/xiangmu/">项目实践</a></li>
<li class="sub-menu">更多教程<span class="icon">&nbsp;&nbsp;&nbsp;&nbsp;</span>
<ul>
<li><a href="/cpp/socket/">Socket编程</a></li>
<li><a href="/cpp/windows/">Windows编程</a></li>
<li><a href="/cpp/linux/">Linux教程</a></li>
<li><a href="/cpp/shell/">Shell教程</a></li>
<li><a href="/cpp/u/yuanma/">C语言实例精讲</a></li>
<li><a href="/cpp/u/c16/">C语言多文件编程</a></li>
</ul>
</li>
<li class="bubble"><a href="http://vip.biancheng.net/" style="color: #D33428;" target="_blank">VIP会员</a><span class="hot">&nbsp;</span></li>
<li class="bubble"><a href="http://fudao.biancheng.net/" style="color: #009300;" target="_blank">辅导班</a><span class="sale">&nbsp;</span></li>
<li><a href="/cpp/about/dig/" target="_blank">读者评价</a></li>
</ul>
</div>
</div>
<div id="position" class="clearfix"><a href='http://c.biancheng.net/cpp/'>首页</a><span>&nbsp;&nbsp;/&nbsp;&nbsp;</span><a href='/cpp/u/biaozhunku/'>C语言标准库</a><span>&nbsp;&nbsp;/&nbsp;&nbsp;</span><a href='/cpp/u/stdio_h/'>stdio.h</a><span>&nbsp;&nbsp;/&nbsp;&nbsp;</span></div>
<div id="main" class="clearfix sidebar-on-right">
<div id="article" class="article">
<h1>C语言perror()函数：打印最近一次系统错误信息</h1>
<div class="art-info clearfix">
<dl class="follow-us left hover-none"></dl>
</div>
<div class="ad-art-body-top">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:inline-block;width:728px;height:90px" data-ad-client="ca-pub-1879607319104103" data-ad-slot="1362048227"></ins>
<script>
				(adsbygoogle = window.adsbygoogle || []).push({});
			</script>
</div>
<div id="ad-arc-top-diy"></div>
<div id="art-body">头文件：#include &lt;stdio.h&gt;<br />
<br />
函数perror()用于抛出最近的一次系统错误信息，其原型如下：<br />
&nbsp; &nbsp; void perror(char *string);<br />
<br />
【参数】string为要输出的错误信息。<br />
<br />
说明：perror()用来将上一个函数发生错误的原因输出到标准错误(stderr)。参数string所指的字符串会先打印出，后面再加上错误原因字符串，此错误原因依照全局变量errno 的值来决定要输出的字符串。<br />
<br />
在库函数中有个errno变量，每个errno值对应着以字符串表示的错误类型。当你调用&quot;某些&quot;函数出错时，该函数已经重新设置了errno的值。perror函数只是将你输入的一些信息和现在的errno所对应的错误一起输出。<br />
<br />
【实例】打开一个不存在的文件并输出错误信息。<br />
#include &lt;stdio.h&gt;<br />
#include &lt;assert.h&gt;<br />
#include &lt;stdlib.h&gt;<br />
int main( void )<br />
{<br />
&nbsp;&nbsp;&nbsp; FILE *fp;<br />
&nbsp;&nbsp;&nbsp; fp = fopen( &quot;test.txt&quot;, &quot;w&quot; );/*打开文件*/<br />
&nbsp;&nbsp;&nbsp; assert( fp ); /*断言不为空*/<br />
&nbsp;&nbsp;&nbsp; fclose( fp );/*关闭*/<br />
&nbsp;&nbsp;&nbsp; fp = fopen( &quot;nulltest.txt&quot;, &quot;r&quot; );/*打开一个不存在的文件*/<br />
&nbsp;&nbsp;&nbsp; if ( NULL == fp )<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*显示最近一次错误信息*/<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; perror(&quot;fopen( \&quot;nulltest.txt\&quot;, \&quot;r\&quot; )&quot;);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return 0;<br />
}<br />
运行结果：<br />
fopen( &quot;nulltest.txt&quot;, &quot;r&quot; ):No such file or directory<br />
<br />
程序先定义一个文件指针fp，之后创建文件 test.txt，断言文件打开成功，然后关闭该文件，再以只读的方式打开文件nulltest.txt，判断该文件指针是否问空，如果为空则使用 perror() 输出错误信息。perror()用来将上一个函数发生错误的原因 输出到标准设备(stderr)。函数参数string所指的字符串会先打印出， 后面再加上错误原因字符串。此错误原因依照全局变量error的值来决定要输出的字符串。<br />
<br />
如果连续调用perror，如下：<br />
<br />
perror(&quot;1&quot;);<br />
<br />
perror(&quot;2&quot;);<br />
<br />
会出现以下结果：<br />
<br />
1:success<br />
<br />
2:Illegal seek<br />
<br />
这种问题出现的原因是：<br />
<br />
perror（）是通过lseek方法根据errorno查找对应的错误信息，然后输出的。<br />
<br />
在程序运行的时候，errorno的初始值对应的信息为：Success。只有程序中有错误出现时，才会改变给errorno。如果没有错误出现，errorno的值是不会改变的。<br />
<br />
但是perror方法是个例外，每次调用perror方法，都会首先输出errorno对应的信息，然后重置errorno为undefined，这时如果马上在一次调用perror，perror中的lseek根据undefined去查找错误信息，就会抛错，错误刚好被记录在errorno中，因此，就把lseek的错误打印出来了。所以第一次调用perror方法的时候会正常数据错误信息，但是如果连续调用第二次，由于第一次的perror调用已经把errorno设置成了undefined，所以连续的第二次，第三次...........第一亿次调用都会输出Illegal seek错误。</div>
<div id="ad-arc-bottom-diy"></div>
<div id="ad-bottom-weixin" class="clearfix">
<div class="left" style="width: 535px;">
<p><span class="col-red">编程帮</span>，一个分享编程知识的公众号。跟着<a class="col-link" href="/cpp/about/author/" target="_blank">站长</a>一起学习，每天都有进步。</p>
<p>通俗易懂，深入浅出，一篇文章只讲一个知识点。</p>
<p>文章不深奥，不需要钻研，在公交、在地铁、在厕所都可以阅读，随时随地涨姿势。</p>
<p>文章不涉及代码，不烧脑细胞，人人都可以学习。</p>
<p>当你决定关注「编程帮」，你已然超越了90%的程序员！</p>
</div>
<div class="right" style="width: 150px;">
<img width="150" src="/cpp/templets/new/images/erweima.png?v=3.97" alt="微信公众号二维码" /><br />
<span class="col-green">微信扫描二维码关注</span>
</div>
</div>
<div class="art-info clearfix">
<dl class="follow-us left hover-none"></dl>
</div>
</div>
<div id="sidebar" class="sidebar">
<div id="ad-sidebar-top" class="ad-google">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:inline-block;width:250px;height:250px" data-ad-client="ca-pub-1879607319104103" data-ad-slot="9494111365"></ins>
<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>
<dl class="arc-list sub-sort">
<dt class="clearfix"><h4><span>下级分类</span></h4></dt>
<dd class='this'><a href='/cpp/u/stdio_h/'>stdio.h</a></dd>
<dd><a href='/cpp/u/stdlab_h/'>stdlib.h</a></dd>
<dd><a href='/cpp/u/conio_h/'>conio.h</a></dd>
<dd><a href='/cpp/u/alloc_h/'>alloc.h</a></dd>
<dd><a href='/cpp/u/graphics_h/'>graphics.h</a></dd>
<dd><a href='/cpp/u/system_h/'>system.h</a></dd>
<dd><a href='/cpp/u/string_h/'>string.h</a></dd>
<dd><a href='/cpp/u/ctype_h/'>ctype.h</a></dd>
<dd><a href='/cpp/u/math_h/'>math.h</a></dd>
<dd><a href='/cpp/u/locale_h/'>locale.h</a></dd>
</dl>
<dl class="arc-list arc-c">
<dt class="clearfix"><h4><span>本站精品教程</span></h4></dt>
<dd><a href='/cpp/u/jiaocheng/'>C语言教程</a></dd>
<dd><a href='/cpp/biancheng/cpp/rumen/'>C++教程</a></dd>
<dd><a href='/cpp/u/c20/'>C语言和内存</a></dd>
<dd><a href='/cpp/u/c16/'>C语言多文件编程（模块化开发）</a></dd>
<dd><a href='/cpp/socket/'>C/C++ socket编程（网络编程）</a></dd>
<dd><a href='/cpp/linux/'>Linux教程</a></dd>
<dd><a href='/cpp/shell/'>Shell教程</a></dd>
<dd><a href='/cpp/windows/'>Windows编程</a></dd>
<dd><a href='http://data.biancheng.net/'>数据结构与算法教程（更新中）</a></dd>
</dl>
<p id="qq-qun-sidebar">
QQ交流群：<b class="col-green qq-qun-number">loading...</b><br />
验证消息：严长生（<span class="col-red">记得填写哦</span>）<br />
<span style="display:inline-block; line-height:26px; vertical-align:top;">一键加群：</span>
<a class="qq-qun-link" style="display:inline-block; line-height:0px;" target="_blank" href="#"><img height="22" border="0" src="//pub.idqqimg.com/wpa/images/group.png" alt="C语言中文网交流群" title="C语言中文网交流群"></a>
</p>
<div id="weixin-sidebar">
<img width="250" src="/cpp/templets/new/images/erweima_sidebar.png?v=3.97" alt="编程帮" />
<p><span class="col-green">编程帮</span>，一个分享编程知识的微信公众号，由站长<span class="col-red">严长生</span>亲自运营</p>
</div>
<iframe id="weibo-sidebar" width="100%" height="382" class="share_self" frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=400&fansRow=1&ptype=1&speed=0&skin=1&isTitle=0&noborder=1&isWeibo=1&isFans=1&uid=3117146305&verifier=636fe378&dpc=1"></iframe>
</div>
</div>
<div id="footer-wrap" class="clearfix">
<div id="footer" class="clearfix">
<div class="left" style="_width: 600px;">
<ul id="nav-bottom" class="clearfix">
<li>
<a href="/cpp/html/1013.html" target="_blank" rel="nofollow">关于C语言中文网</a>
<span class="blank">|</span>
</li>
<li>
<a href="/cpp/about/author/" target="_blank" rel="nofollow">关于站长</a>
<span class="blank">|</span>
</li>
<li>
<a href="/cpp/about/tutorial/" target="_blank" rel="nofollow">如何才能完成一部教程</a>
<span class="blank">|</span>
</li>
<li>
<a href="/cpp/html/1014.html" target="_blank" rel="nofollow">联系我们</a>
<span class="blank">|</span>
</li>
<li>
<a href="/cpp/sitemap/" target="_blank" rel="nofollow">网站地图</a>
<span class="blank">|</span>
</li>
<li>
<a href="http://m.biancheng.net/" target="_blank" rel="nofollow">手机版网站</a>
</li>
</ul>
<p>
精美而实用的网站，关注编程技术，追求极致，让您轻松愉快的学习。<br />
Copyright &copy;2011-2015 biancheng.net, All Rights Reserved，陕ICP备15000209号
</p>
</div>
<img id="logo-bottom" class="right" src="/cpp/templets/new/images/logo_bottom.jpg?v=3.97" alt="底部Logo" />
</div>
</div>
<div id="qq-qun-float">
<div class="box">
<div class="filler">
<p class="header">
<img width="60" height="60" src="/cpp/templets/new/images/qq.png?v=3.97" alt="C语言中文网交流群" /><br />
<span style="font-size: 18px; color: #f9f9f9;">QQ交流群</span>
</p>
<p style="font-size: 20px;"><span class="col-green qq-qun-number">loading...</span></p>
<p style="padding: 0px;">验证消息：<span class="col-red">严长生</span></p>
<p><a class="qq-qun-link" style="display:inline-block; line-height:0px;" target="_blank" href="#"><img height="22" border="0" src="//pub.idqqimg.com/wpa/images/group.png" alt="C语言中文网交流群" title="C语言中文网交流群"></a></p>
<span class="btn-close" id="btn-close-qq-qun">×</span>
</div>
</div>
</div>
<script type="text/javascript">
    var cmsPath = '/cpp', // CMS安装目录，不带 /
        cmsTemplets = '/cpp/templets/new', // 模板目录，不带 /
        cmsTempletsVer = 3.97;  // 版本号
</script>
<script src="/cpp/templets/new/script/jquery.min.js?v=3.97" type="text/javascript"></script>
<script src="/cpp/templets/new/script/common.js?v=3.97" type="text/javascript"></script>
<span id="cnzz-wrap">
<script type="text/javascript">
        var cnzz = {};

        cnzz.positionHref = $("#position").children('a')[1];
        cnzz.positionHref && ( cnzz.positionHref = cnzz.positionHref.getAttribute('href') );
        cnzz.protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
        cnzz.webName = 'c';

        cnzz.webIdObj = {
            'c': '3875484',
            'cpp': '4153548',
            'swift': '5937701',
            'shell': '5809059',
            'danpianji': '5867261'
        };

        if(cnzz.positionHref) if( /^\/cpp\/biancheng/.test(cnzz.positionHref) ){
            cnzz.webName = 'cpp';
        }else if( /^\/cpp\/swift/.test(cnzz.positionHref) ){
            cnzz.webName = 'swift';
        }else if( /^\/cpp\/shell/.test(cnzz.positionHref) ){
            cnzz.webName = 'shell';
        }else if( /^\/cpp\/danpianji/.test(cnzz.positionHref) ){
            cnzz.webName = 'danpianji';
        }

        document.write(unescape("%3Cspan id='cnzz_stat_icon_"+ cnzz.webIdObj[cnzz.webName] +"'%3E%3C/span%3E%3Cscript src='" + cnzz.protocol + "s6.cnzz.com/stat.php%3Fid%3D"+ cnzz.webIdObj[cnzz.webName] +"' type='text/javascript'%3E%3C/script%3E"));
    </script>
</span>
<script type="text/javascript">
// 当前文章ID
window.thisArtId = 347;
</script>
</body>
</html>